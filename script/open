#!/data/data/com.termux/files/usr/bin/bash
# Enhanced folder navigator + file action chooser + command parser

# Start in current directory; navigation via cd
while true; do
  echo
  echo "📂 Listing: $(pwd)"
  items=()
  idx=1
  for item in *; do
    items+=("$item")
    printf "%2d) %s\n" "$idx" "$item"
    idx=$((idx+1))
  done

  echo
  read -p "Enter command (number to open, 'open <name>', or 'X' to exit): " input

  # Exit
  if [[ "$input" =~ ^[Xx]$ ]]; then
    echo "Exiting..."
    break
  fi

  # Direct open command: open <filename|foldername>
  if [[ "$input" =~ ^open[[:space:]]+(.+) ]]; then
    target="${BASH_REMATCH[1]}"
    if [ -d "$target" ]; then
      cd "$target" || { echo "❌ Cannot enter directory '$target'"; break; }
      continue
    elif [ -f "$target" ]; then
      echo
      echo "📄 File selected: $target"
      echo "1) Open using external tool (termux-open)"
      echo "2) Edit using nano"
      read -p "Choose 1 or 2: " opt
      case "$opt" in
        1) termux-open "$target" ;;
        2) nano "$target" ;;
        *) echo "❌ Invalid option." ;;
      esac
      break
    else
      echo "❓ '$target' not found in current directory."
      continue
    fi
  fi

  # Number selection
  if [[ "$input" =~ ^[0-9]+$ ]]; then
    choice=$input
    if [ "$choice" -lt 1 ] || [ "$choice" -gt "${#items[@]}" ]; then
      echo "Invalid selection — try again." >&2
      continue
    fi
    selected="${items[$((choice-1))]}"

    if [ -d "$selected" ]; then
      cd "$selected" || { echo "❌ Cannot enter directory '$selected'"; break; }
      continue
    elif [ -f "$selected" ]; then
      echo
      echo "📄 File selected: $selected"
      echo "1) Open using external tool (termux-open)"
      echo "2) Edit using nano"
      read -p "Choose 1 or 2: " act
      case "$act" in
        1) termux-open "$selected" ;;
        2) nano "$selected" ;;
        *) echo "❌ Invalid option." ;;
      esac
      break
    else
      echo "❓ Not a file or folder — exiting."
      break
    fi
  else
    echo "Invalid command — please enter a number, 'open <name>', or 'X'." >&2
  fi
done
