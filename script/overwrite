#!/usr/bin/env bash

if [ -z "$1" ]; then
  echo "Usage: overwrite <filename>"
  exit 1
fi

if [ -n "$DEVSHELL_PROJECT_ID" ]; then
    PASTE_CMD="manual_mobile"
elif command -v pbpaste &> /dev/null; then
    PASTE_CMD="pbpaste"
elif command -v xclip &> /dev/null; then
    PASTE_CMD="xclip -selection clipboard -o"
elif command -v xsel &> /dev/null; then
    PASTE_CMD="xsel --clipboard --output"
elif command -v wl-paste &> /dev/null; then
    PASTE_CMD="wl-paste"
elif command -v termux-clipboard-get &> /dev/null; then
    PASTE_CMD="termux-clipboard-get"
elif command -v powershell.exe &> /dev/null; then
    PASTE_CMD="powershell.exe -Command Get-Clipboard"
else
    PASTE_CMD="manual_mobile"
fi

if [ "$PASTE_CMD" == "manual_mobile" ]; then
    echo "ðŸ“± Headless/Mobile Mode Detected."
    echo "1. Long-press to PASTE your content below."
    echo "2. On a NEW LINE, type 'DONE' and press Enter to save."
    echo "--------------------------------------------------"
    
    > "$1"

    while IFS= read -r line; do
        if [[ "$line" == "DONE" ]]; then
            break
        fi
        echo "$line" >> "$1"
    done
    
    echo "--------------------------------------------------"
    echo "âœ… Success: Saved to '$1' (excluding the 'DONE' keyword)."
else
    $PASTE_CMD > "$1"
    echo "âœ… Success: Clipboard content pasted into '$1'."
fi
